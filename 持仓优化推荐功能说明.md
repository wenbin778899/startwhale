# 持仓优化推荐功能说明

## 功能概述

本系统新增了基于现代投资组合理论的持仓优化推荐功能，利用数学模型为用户提供科学的资产配置建议，帮助投资者优化风险收益平衡。

## 核心算法

### 1. 现代投资组合理论 (Modern Portfolio Theory, MPT)
- 基于马科维茨均值方差模型
- 通过数学优化寻找最佳资产配置
- 在给定风险水平下最大化预期收益
- 在给定收益目标下最小化投资风险

### 2. 优化策略

#### 2.1 最大夏普比率优化
- **目标**: 最大化风险调整收益
- **公式**: 夏普比率 = (投资组合收益率 - 无风险收益率) / 投资组合标准差
- **适用**: 追求最佳风险调整收益的投资者
- **算法**: 权重 = max(0, 夏普比率) / Σmax(0, 夏普比率)

#### 2.2 最小风险优化
- **目标**: 在保持收益的前提下最小化投资风险
- **适用**: 风险厌恶型投资者
- **算法**: 反向波动率加权，权重 = (1/波动率) / Σ(1/波动率)

#### 2.3 平衡配置优化
- **目标**: 基于资产类型的平衡配置
- **策略**: 股票60% + 基金40%的经典配置
- **适用**: 稳健型投资者

## 功能特性

### 1. 智能数据分析
- 自动计算各资产的预期收益率
- 估算历史波动率（风险指标）
- 计算夏普比率等关键指标
- 分析当前投资组合表现

### 2. 可视化展示
- **权重配置对比图**: 直观对比当前配置与优化配置
- **风险收益散点图**: 展示各资产的风险收益特征
- **策略效果对比**: 量化展示优化效果

### 3. 智能推荐建议
- 具体的调仓操作建议
- 权重调整幅度计算
- 资金调整金额估算
- 预期收益和风险变化

## 使用方法

### 1. 访问功能
1. 登录系统，进入"持仓管理"页面
2. 选择要优化的投资组合
3. 切换到"优化推荐"标签页

### 2. 选择优化策略
- **最大夏普比率**: 适合追求最佳风险调整收益
- **最小风险**: 适合保守型投资者
- **平衡配置**: 适合稳健型投资者

### 3. 查看优化建议
- **优化效果对比**: 查看预期收益率、风险、夏普比率的改善
- **具体调仓建议**: 查看每只股票/基金的调仓建议
- **权重分析**: 通过图表分析权重配置变化

### 4. 执行优化
- 参考系统建议进行手动调仓
- 或使用"一键执行优化"功能（未来版本）

## 技术实现

### 1. 后端API
```python
# 优化建议API端点
GET /api/portfolio/{portfolio_id}/optimization

# 返回数据结构
{
    "portfolio_info": {},           # 组合基本信息
    "assets_stats": [],            # 资产统计数据
    "optimization_strategies": {}, # 各优化策略结果
    "recommendations": [],         # 调仓建议
    "current_portfolio_metrics": {} # 当前组合指标
}
```

### 2. 前端组件
- `PortfolioOptimization.js`: 主要优化组件
- 集成到 `PortfolioManagement.js` 的新标签页
- 使用 ECharts 进行数据可视化

### 3. 算法函数
- `calculate_max_sharpe_weights()`: 最大夏普比率权重计算
- `calculate_min_risk_weights()`: 最小风险权重计算
- `calculate_balanced_weights()`: 平衡配置权重计算
- `generate_rebalance_recommendations()`: 生成调仓建议

## 数据计算说明

### 1. 风险指标计算
```python
# 简化的波动率计算（基于收益率绝对值）
volatility_stock = abs(return_rate) * 2    # 股票波动率
volatility_fund = abs(return_rate) * 1.5   # 基金波动率（通常较低）
```

### 2. 夏普比率计算
```python
# 假设无风险收益率为3%
sharpe_ratio = (return_rate - 0.03) / (volatility + 0.01)
```

### 3. 投资组合风险计算
```python
# 简化的组合波动率（不考虑相关性）
portfolio_volatility = sqrt(Σ(weight_i * volatility_i)²)
```

## 风险提示

### 1. 模型限制
- 基于历史数据，不能预测未来表现
- 简化的风险计算，未考虑资产间相关性
- 市场环境变化可能影响模型有效性

### 2. 使用建议
- 仅作为投资参考，不构成投资建议
- 需结合个人风险承受能力和投资目标
- 建议定期重新评估和调整
- 分散投资，避免过度集中

### 3. 数据准确性
- 依赖于持仓数据的准确性和及时性
- 建议定期更新股票和基金价格
- 收益率基于当前盈亏计算

## 后续优化方向

### 1. 算法增强
- 引入资产相关性矩阵
- 添加更多约束条件（如最大持仓比例）
- 支持自定义风险厌恶系数

### 2. 功能扩展
- 一键执行调仓功能
- 历史优化效果追踪
- 更多优化策略选择

### 3. 数据改进
- 使用更长期的历史数据计算风险
- 集成市场基准指数对比
- 添加行业配置分析

## 联系方式

如有技术问题或改进建议，请联系开发团队。

---

*该功能基于现代投资组合理论开发，旨在为投资者提供科学的资产配置参考。投资有风险，决策需谨慎。* 